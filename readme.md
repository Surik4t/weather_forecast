## Тестовое задание - HTTP-сервер для предоставления информации по погоде с использованием асинхронного фреймворка.

### ТЗ:
REST API сервис со следующими методами:
* Метод принимает координаты и возвращает данные о температуре, скорости ветра и атмосферном
давлении на момент запроса.

* Метод принимает название города и его координаты и добавляет в список городов, для которых
отслеживается прогноз погоды. Сервер должен хранить прогноз погоды для указанных городов на текущий
день и обновлять его каждые 15 минут.

* Метод возвращает список городов, для которых доступен прогноз погоды.

* Метод принимает название города и время и возвращает для него погоду на текущий день в указанное
время. Должна быть возможность выбирать, какие параметры погоды получать в ответе — температура,
влажность, скорость ветра, осадки.

Данные получать из open-meteo API: https://open-meteo.com/.

Дополнительно:

* Добавить возможность работы с несколькими пользователями — реализовать метод регистрации
пользователя, который принимает имя пользователя и возвращает его ID. Для каждого пользователя должен
храниться свой список городов и соответствующие прогнозы погоды. Для этого методам 2, 3 и 4 необходимо
передавать ID пользователя.
* Написать юнит-тесты на методы API.

### Требования к заданию
* В качестве решения принимается скрипт на Python с описанием методов в файле readme.md. Скрипт
запускается следующим образом: python3 script.py.

* После этого по адресу 127.0.0.1 и порту 8000 можно обращаться к указанным выше функциям.

* Данные допускается хранить в файле или в базе данных SQLite. реализовать таким образом, чтобы не требовалась дополнительная настройка программы или наличие БД на машине.

## Реализация

### Стек:
* Бэкенд фреймворк - FastAPI
* База данных - SQLite

> Для корректной работы проекта, необходимо установить зависимости - `pip install -r reqs.txt`

Запуск сервера осуществляется через скрипт - `python3 script.py`

### Методы API

> Для удобства тестирования, можно использовать [Swagger](http://127.0.0.1:8000/docs#/)

* /forecast/current - Принимает координаты и возвращает данные о погоде (температуре, скорости ветра, атмосферном давлении) по указанным координатам на момент запроса.
```
curl -X POST "http://127.0.0.1:8000/forecast/current" \
  -H "Content-Type: application/json" \
  -d '{
  "latitude": 0,
  "longitude": 0
}'
```
Где latitude - широта (float от -90 до 90), longitude (float от -180 до 180) - долгота.  

* /users/{username} - Метод регистрации пользователя, который принимает имя пользователя и возвращает его ID.
```
curl -X PUT "http://127.0.0.1:8000/users/testuser"
```

* /users/all - Возвращает список всех зарегистрированных в базе данных пользователей.
```
curl -X GET "http://127.0.0.1:8000/users/all"
```

* /cities/add_city - Принимает координаты, название города, ID пользователя. Сохраняет город в базе данных с ссылкой на пользователя, 
```
curl -X PUT "http://127.0.0.1:8000/cities/" \
  -H "accept: application/json" \
  -H "Content-Type: application/json" \
  -d '{
  "latitude": 55.7558,
  "longitude": 37.6176,
  "name": "Moscow",
  "user_id": "User ID"
}'
```

* /cities/all/{user_id} - В качестве параметра принимает ID пользователя, возвращает список городов, сохраненных пользователем.
```
curl -X GET "http://127.0.0.1:8000/cities/all/testuserID"
```

* /cities/city_forecast - Принимает следующие json параметры:
```
{
  "user_id": "User ID", 
  "city_name": "City Name", # Название города
  "time_hours": 12, # Время, на которое делается прогноз в часах (местное для города) 
  "temp": true, # Флаг, если true - возвращает данные о температуре
  "humidity": true, # если true - возвращает данные о влажности воздуха
  "wind": true, # если true - возвращает данные о скорости ветра
  "precipitation": true # если true - возвращает данные об осадках (rain - дождь, shower - ливень, snow - снег)
}
```
Возвращает данные о погоде сохраненного пользователем города.  
Если данные отсутствуют на сервере либо неактуальны (обновлялись более 15 минут назад), то метод запрашивает данные по API и возвращает их, сохраняя в БД. 

```
curl -X 'POST' \
  'http://127.0.0.1:8000/cities/city_forecast' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "user_id": "testuserID",
  "city_name": "Tokyo",
  "time_hours": 12,
  "temp": true,
  "humidity": true,
  "wind": true,
  "precipitation": true
}'
```
